pipeline:
  name: flow-build-test
  identifier: flowbuildtest
  projectIdentifier: NgLabs
  orgIdentifier: default
  tags: {}
  stages:
    - stage:
        name: ounit_test_linux
        identifier: ounit_test_linux
        description: ""
        type: CI
        spec:
          cloneCodebase: true
          platform:
            os: Linux
            arch: Amd64
          runtime:
            type: Cloud
            spec: {}
          execution:
            steps:
              - step:
                  type: Run
                  name: Create cache breaker
                  identifier: Create_cache_breaker
                  spec:
                    shell: Sh
                    command: |
                      .circleci/make_opam_cachebreaker.sh > .circleci/opamcachebreaker
              - step:
                  type: Run
                  name: Install opam
                  identifier: Install_opam
                  spec:
                    shell: Sh
                    command: |
                      bash -c "sh <(curl -fsSL https://raw.githubusercontent.com/ocaml/opam/master/shell/install.sh)"
                  when:
                    stageStatus: All
                  failureStrategies: []
              - step:
                  type: Run
                  name: Init opam
                  identifier: Init_opam
                  spec:
                    shell: Sh
                    command: |
                      .circleci/opam_init.sh
                  when:
                    stageStatus: All
                  failureStrategies: []
              - step:
                  type: Run
                  name: install deps from opam
                  identifier: install_deps_from_opam
                  spec:
                    shell: Sh
                    command: |-
                      #!/bin/bash -eo pipefail
                      make deps
                  when:
                    stageStatus: All
                  failureStrategies: []
              - step:
                  type: Run
                  name: Install extra deps from opam
                  identifier: Install_extra_deps_from_opam
                  spec:
                    shell: Sh
                    command: |-
                      #!/bin/bash -eo pipefail
                      opam install ounit2.2.2.4 | cat
                  when:
                    stageStatus: All
                  failureStrategies: []
              - step:
                  type: Run
                  name: Run tests
                  identifier: Run_tests
                  spec:
                    shell: Sh
                    command: |-
                      #!/bin/bash -eo pipefail
                      opam exec -- make ounit-tests-ci
                  when:
                    stageStatus: All
                  failureStrategies: []
  properties:
    ci:
      codebase:
        connectorRef: gitconnectordhruba
        repoName: flow
        build: <+input>
